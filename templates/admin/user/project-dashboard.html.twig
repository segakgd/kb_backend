{% extends 'base.html.twig' %}

{% block title %}Дашборд{% endblock %}

{% block main %}

    <div class="container">
        <div class="row">
            <div class="col-8">
                <div class="">
                    <div class="">
                        <h2>Боты</h2>
                    </div>

                    <div class="">
                        {% if bots is empty %}
                            <div class="">
                                Данных нет
                            </div>
                        {% endif %}

                        {% for bot in bots %}
                            <div class="">
                                <div class="">Название бота: {{ bot.botName }}</div>
                                <div class="">
                                    <section>
                                        <span>Проект:</span> {{ bot.projectName }}
                                    </section>
                                    <section>
                                        <span>Состояние:</span>
                                        {% if bot.botActive is not empty %}
                                            <span class="">Активен</span>
                                        {% else %}
                                            <span class="">Не активен</span>
                                        {% endif %}
                                    </section>
                                    <section>
                                        <span>Тип:</span> {{ bot.botType }}
                                    </section>
                                    <section>
                                        <span>Токен:</span> {{ bot.botToken }}
                                    </section>
                                    <section>
                                        <span>Вебхук:</span> {{ bot.webhookUri }}
                                    </section>

                                    <form style="width: 100%; display:flex;"
                                          action="/dev/project/{{ bot.projectId }}/bot/{{ bot.botId }}/fake_message/"
                                          method="POST">
                                        <label style="width: 100%;">
                                            <input class="" style="color: #18181b;" type="text"
                                                   placeholder="Текст сообщения"
                                                   name="message">
                                        </label>
                                        <button class="">
                                            Отправить
                                        </button>
                                    </form>

                                    <hr>

                                    {% if bot.webhookInfo.pendingUpdateCount is not null %}
                                        <section>
                                            <span>Количество обновлений, ожидающих доставки:</span> {{ bot.webhookInfo.pendingUpdateCount }}
                                        </section>
                                    {% endif %}

                                    {% if bot.webhookInfo.lastErrorDate is not null %}
                                        <section class="jj__color-red">
                                            <span>Дата ошибки:</span> {{ bot.webhookInfo.lastErrorDate }}
                                        </section>
                                    {% endif %}

                                    {% if bot.webhookInfo.lastErrorMessage is not null %}
                                        <section class="jj__color-red">
                                            <span>Сообщение об ошибки:</span> {{ bot.webhookInfo.lastErrorMessage }}
                                        </section>
                                    {% endif %}
                                </div>
                                <div class="jj__item_data jj__item_data--line">
                                    <section>
                                        <a href="/dev/project/{{ bot.projectId }}/bot/{{ bot.botId }}/webhook/activate/">установить
                                            вебхук</a>
                                    </section>

                                    {% if bot.botActive is not empty %}
                                        <section>
                                            <a href="/dev/project/{{ bot.projectId }}/bot/{{ bot.botId }}/deactivate/">Отключить
                                                бота</a>
                                        </section>
                                    {% else %}
                                        <section>
                                            <a href="/dev/project/{{ bot.projectId }}/bot/{{ bot.botId }}/activate/">Включить
                                                бота</a>
                                        </section>
                                    {% endif %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>


            </div>

            <div class="col-4">
                <div class="">
                    <div class="">
                        <h2>Сессии</h2>
                    </div>

                    <div class="">
                        {% if sessions is empty %}
                            <div class="">
                                Данных нет
                            </div>
                        {% endif %}

                        {% for session in sessions %}
                            <div class="">
                                <a href="/admin/session/{{ session.id }}/" target="_blank">
                                    <div class="">Название сессии: {{ session.sessionName }}</div>

                                    <div class="">
                                        <section>
                                            <span>Канал:</span> {{ session.sessionChannel }}
                                        </section>
                                        <section style="font-weight: bold; color: #ca0a9d;">
                                            <span>Контент:</span> {{ session.cache.content }}
                                        </section>

                                        {% if session.sessionVisitorEvent is defined %}
                                            <section>
                                                <span>Тип события:</span> {{ session.sessionVisitorEvent.type }}
                                            </section>
                                            <section>
                                                <span>Статус последнего события:</span> {{ session.sessionVisitorEvent.status }}
                                            </section>
                                        {% endif %}
                                    </div>
                                </a>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>





    {#    <div class="jj__main_wrapper jj__main_wrapper--line"> #}
    {#        <div class="jj__wrapper jj__wrapper-50"> #}
    {#            <div class="jj__h"> #}
    {#                <h2>Сценарии</h2> #}
    {#            </div> #}

    {#            <div class="jj__items"> #}
    {#                {% if scenarios is empty %} #}
    {#                    <div class="jj__items-without-data"> #}
    {#                        Данных нет #}
    {#                    </div> #}
    {#                {% endif %} #}

    {#                {% for scenarioItem in scenarios %} #}
    {#                    <div class="jj__item"> #}
    {#                        <div class="jj__item_name">Сценарий #{{ scenarioItem.id }}</div> #}

    {#                        <div class="jj__item_data jj__item_data--line"> #}
    {#                            <section> #}
    {#                                <span>Название:</span> {{ scenarioItem.name }} #}
    {#                            </section> #}
    {#                        </div> #}

    {#                        <div class="jj__item_data jj__item_data--line"> #}
    {#                            <section> #}
    {#                                <form action="/dev/project/{{ projectId }}/scenario/{{ scenarioItem.id }}/apply/" #}
    {#                                      method="GET"> #}
    {#                                    <label> #}
    {#                                        Подключить бот: #}
    {#                                        <select name="botId"> #}
    {#                                            {% for bot in bots %} #}
    {#                                                <option value="{{ bot.botId }}">{{ bot.botName }}</option> #}
    {#                                            {% endfor %} #}
    {#                                        </select> #}
    {#                                        к сценарию #}
    {#                                    </label> #}

    {#                                    <button> #}
    {#                                        Подключить #}
    {#                                    </button> #}
    {#                                </form> #}
    {#                            </section> #}
    {#                        </div> #}
    {#                    </div> #}
    {#                {% endfor %} #}
    {#            </div> #}
    {#        </div> #}
    {#    </div> #}

{% endblock %}
